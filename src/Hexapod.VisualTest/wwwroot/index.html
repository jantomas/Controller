<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hexapod Visual Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #1a1a2e; color: #e0e0e0; overflow: hidden; }
        
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        #panel {
            position: absolute; top: 16px; right: 16px; width: 320px;
            background: rgba(22, 28, 45, 0.92); border: 1px solid #334; border-radius: 10px;
            padding: 18px; backdrop-filter: blur(8px); max-height: calc(100vh - 32px); overflow-y: auto;
        }
        #panel h2 { font-size: 15px; color: #7eb8ff; margin-bottom: 12px; letter-spacing: 0.5px; }
        #panel h3 { font-size: 13px; color: #8aa; margin: 14px 0 6px; }
        
        .control-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .control-row label { min-width: 22px; font-size: 13px; color: #aac; }
        .control-row input[type="number"] {
            flex: 1; background: #0d1117; border: 1px solid #334; border-radius: 5px;
            color: #e0e0e0; padding: 6px 8px; font-size: 13px; width: 80px;
        }
        .control-row input[type="range"] { flex: 1; accent-color: #5588cc; }
        .control-row .value-display { min-width: 55px; text-align: right; font-size: 12px; color: #7a9; font-family: monospace; }
        
        select {
            width: 100%; background: #0d1117; border: 1px solid #334; border-radius: 5px;
            color: #e0e0e0; padding: 6px 8px; font-size: 13px; margin-bottom: 10px;
        }
        
        button {
            width: 100%; padding: 8px; border: none; border-radius: 6px; cursor: pointer;
            font-size: 13px; font-weight: 600; margin-bottom: 6px; transition: background 0.2s;
        }
        .btn-primary { background: #2563eb; color: #fff; }
        .btn-primary:hover { background: #3b82f6; }
        .btn-secondary { background: #334155; color: #cbd5e1; }
        .btn-secondary:hover { background: #475569; }
        
        #status {
            margin-top: 10px; padding: 8px; border-radius: 5px; font-size: 12px;
            font-family: monospace; min-height: 40px; background: #0d1117; border: 1px solid #223;
            white-space: pre-line;
        }
        .status-ok { color: #4ade80; }
        .status-error { color: #f87171; }
        
        #info-bar {
            position: absolute; bottom: 16px; left: 16px;
            background: rgba(22, 28, 45, 0.85); border: 1px solid #334; border-radius: 8px;
            padding: 10px 16px; font-size: 12px; color: #8aa; backdrop-filter: blur(8px);
        }
        #info-bar span { color: #7eb8ff; font-weight: 600; }

        .mode-tabs { display: flex; gap: 4px; margin-bottom: 12px; }
        .mode-tab {
            flex: 1; padding: 6px; border: 1px solid #334; border-radius: 5px; background: #0d1117;
            color: #8aa; text-align: center; cursor: pointer; font-size: 12px; font-weight: 600;
        }
        .mode-tab.active { background: #2563eb; color: #fff; border-color: #2563eb; }

        .legend { margin-top: 10px; padding: 8px; border: 1px solid #223; border-radius: 5px; background: #0d1117; }
        .legend h4 { font-size: 11px; color: #7eb8ff; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 3px; font-size: 11px; }
        .legend-swatch { width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div id="panel">
        <h2>ðŸ¦Ž Hexapod Visual Test</h2>

        <label for="leg-select" style="font-size:12px; color:#8aa;">Active Leg</label>
        <select id="leg-select"></select>

        <div class="mode-tabs">
            <div class="mode-tab active" data-mode="ik" onclick="setMode('ik')">IK (Target)</div>
            <div class="mode-tab" data-mode="fk" onclick="setMode('fk')">FK (Angles)</div>
        </div>

        <!-- IK mode: target position -->
        <div id="ik-controls">
            <h3>Target Position (mm)</h3>
            <div class="control-row">
                <label>X</label>
                <input type="number" id="target-x" value="180" step="5" />
            </div>
            <div class="control-row">
                <label>Y</label>
                <input type="number" id="target-y" value="0" step="5" />
            </div>
            <div class="control-row">
                <label>Z</label>
                <input type="number" id="target-z" value="-80" step="5" />
            </div>
            <button class="btn-primary" onclick="solveIK()">Solve IK</button>
        </div>

        <!-- FK mode: joint angles -->
        <div id="fk-controls" style="display:none;">
            <h3>Joint Angles (Â°)</h3>
            <div class="control-row">
                <label>C</label>
                <input type="range" id="angle-coxa" min="-45" max="45" value="0" step="0.5" oninput="updateFk()" />
                <span class="value-display" id="val-coxa">0.0Â°</span>
            </div>
            <div class="control-row">
                <label>F</label>
                <input type="range" id="angle-femur" min="-60" max="90" value="20" step="0.5" oninput="updateFk()" />
                <span class="value-display" id="val-femur">20.0Â°</span>
            </div>
            <div class="control-row">
                <label>T</label>
                <input type="range" id="angle-tibia" min="30" max="150" value="90" step="0.5" oninput="updateFk()" />
                <span class="value-display" id="val-tibia">90.0Â°</span>
            </div>
            <button class="btn-primary" onclick="solveFK()">Compute FK</button>
        </div>

        <button class="btn-secondary" onclick="resetView()">Reset Camera</button>

        <div class="legend">
            <h4>Legend</h4>
            <div class="legend-item"><div class="legend-swatch" style="background:#3a4a5c"></div> Body (hexagonal plate)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#99aa66"></div> Mount point (bodyâ†’coxa)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#44aa88"></div> Coxa segment (hip)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#4488cc"></div> Femur segment (thigh)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#9966dd"></div> Tibia segment (shin)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#ddcc33"></div> Joint (coxa / femur / tibia)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#ff6644"></div> Foot (tip)</div>
            <div class="legend-item"><div class="legend-swatch" style="background:#44ff88"></div> IK target position</div>
        </div>

        <div id="status"></div>
    </div>

    <div id="info-bar">
        <span>Controls:</span> Left-drag rotate Â· Right-drag pan Â· Scroll zoom Â· Click target sphere to drag
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
